# 新加坡SSPAppServer接口文档

**修改记录**

| 修改人 | 修改日期 | 修改内容 | 当前版本 |
| ------ | -------- | -------- | -------- |
|        |          |          |          |
|        |          |          |          |



[TOC]

## 1 引言

新加坡SSPAppServer后台提供APP各个功能接口供APP调用。

## 2 总体方案

### 2.1设计原则

### 2.2 技术架构

### 2.3 业务说明

提供APP后台登录、交易及查询功能详细业务流程请查阅流程图

## 3 业务功能

APPServer承担APP后台功能，提供登录、查询用户信息、修改用户密码、推送绑定、推送解绑、
获取商户信息、商户交易列表查询、交易信息查询、获取用户二维码、交易结果查询等接口供APP
调用。

| 业务    | 说明                  |
| ------- | --------------------- |
| 用户登录 | APP用户根据商户号、登录名、密码等信息登录APP |
| 获取用户信息 | 获取用户的详细信息 |
| 修改用户密码 | APP用户对密码进行修改 |
| 推送绑定 | 绑定推送时需要的用户设备信息 |
| 推送解绑 | 解绑推送时需要的用户设备信息 |
| 获取商户信息 | 查询商户详细信息 |
| 商户交易列表查询 | 根据商户号和交易时间查询商户交易信息列表 |
| 交易信息查询 | 根据商户号及交易流水号查询交易信息详情 |
| 获取用户二维码 | 根据金额生成商户交易二维码 |
| 交易结果查询 | 根据交易查询号查询结果 |

### 3.1 用户登录

APP用户根据商户号、登录名、密码等信息登录APP

| 服务说明 | 执行内容    |
| -------- | ----------- |
| 用户登录    | 提供APP登录功能 |
| 接口方式 |      post请求       |
| 接口地址 |      http://ip:port/oauth/token       |
| 参数     |      商户号、登录名、密码等信息       |
| 出参方式 |      token信息json串       |

#### 3.1.1 用户登录的入参字段说明

| 字段名 | 含义     | 字段类型 | 是否必填 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
| authorization   | 验证信息 | String     | 是   | Basic 商户号@登录名：登录密码转base64字符串 例：Basic MTIzNDU2Nzg5MDEyMzQ1QGFkbWluOjExMTExMQ== |
| grant_type | oauth2验证类型 | String| 是| client_credentials 固定值 |
#### 3.1.2 用户登录的出参字段说明

| 字段名 | 含义     | 字段类型 | 是否必填 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
| access_token   | token信息 | String     | 是   | 用户登录成功的token信息 |
| token_type | token类型 | String | 是| token类型 |
| expires_in | token过期时间 | String | 是 | token过期时间超过该日期后需要重新登录 |
| scope | 访问权限 | String | 是 |该用户可操作的权限|

### 3.2用户业务
用户处理业务包括：查看用户信息/修改商户密码/接受推送绑定/删除推送解绑。
#### 3.2.1 用户业务的入参字段说明（http://ip:port简称ip:port）
| 字段名 | 含义     | 字段类型 | 是否必填 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
|user|获取用户信息|String|是|请求路径 ip:port/user|
|updatePwd/oldPwd|修改商户密码|String|是|ip:port/user/updatePwd?oldPwd=111111&newPwd=222222|
|bindPush|推送绑定|String|是|ip：port/user/bindPush?pushType=设备类型&deviceNo=设备ID&platform=设备平台|Post/platform 设备平台|
|unBindPush|推送解绑|String|是|ip：port/user/unBindPush|
#### 3.3.2 用户业务的出参字段说明
|请求| 出参类型 | 出参结果   | 出参结果含义|
| ------ | -------- | -------- | -------- | -------- |
|获取用户信息|UserInfo|{"merNo": "787913470","loginName": "111111","userName": admin,"roles": 经理,"termNo": 03,"ccyType": $}|merNo->商户号 loginName->登录名 userName->用户名 passWord->用户密码 roles->角色 termNo->终端号 ccyType->交易币种|
|修改商户密码|boolean|FALSE|TRUE/FALSE 成功/失败 |
|推送绑定|UserInfo|{"merNo": "787913470","loginName": "111111","userName": admin,"roles": 经理,"termNo": 03,"ccyType": $}|merNo->商户号 loginName->登录名 userName->用户名 passWord->用户密码 roles->角色 termNo->终端号 ccyType->交易币种|
推送解绑|boolean|TRUE|TRUE/FALSE 成功/失败|
## 4.1 交易业务
交易业务包括：获取商户信息/获取全部交易详情/获取具体交易详情
#### 4.2 用户交易入参字段说明

| 字段名 | 含义     | 字段类型 | 是否必填 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
|subMer|获取商户信息|String|是|ip:port/tran/subMer|
|merNo/tranDate|交易单号/交易时间|String|是|ip:port/tran/merNo?tranDate=2018-03-15|
|tran/merNo/id|通过集团商户号/id获取交易详情|String|是|ip:port/tran/418057105/787913470|
#### 4.3 用户交易出参字段说明

|请求| 出参类型 | 出参结果   | 出参结果含义|
| ------ | -------- | -------- | -------- | -------- |
|获取商户信息|Map<String, String>|{"787913470": "肯德基"} | 商户号：商户中文名称
|交易单号/交易时间|List<TranInfo>|[{"traceNo": "787913470","batchNo": D026268,"invoiceNo": 84270402,"tranAmt": 1000,"tranType":"付款","tranDate": "2018-08-01 15：20：01","channel": "pos","cardNo": "52131608646","merNo": "787913479", "termNo": "277427","authNo": "06,"rrn": "03","mcc": "5812","respCode": "200"}]|traceNo->流水号 batchNo-> 批次号 invoiceNo->票据号 tranAmt->交易金额 tranType->交易类型 tranDate->交易时间 channel->交易渠道 cardNo->卡号 merNo->商户号 termNo->终端号 authNo-> 授权号 rrn-> 参考号 mcc->mcc码 respCode->返回码|
|通过集团商户号/id获取交易详情|TranInfo|{"traceNo": "787913470","batchNo": D026268,"invoiceNo": 84270402,"tranAmt": 1000,"tranType":"付款","tranDate": "2018-08-01 15：20：01","channel": "pos","cardNo": "52131608646","merNo": "787913479", "termNo": "277427","authNo": "06,"rrn": "03","mcc": "5812","respCode": "200"}|traceNo->流水号 batchNo-> 批次号 invoiceNo->票据号 tranAmt->交易金额 tranType->交易类型 tranDate->交易时间 channel->交易渠道 cardNo->卡号 merNo->商户号 termNo->终端号 authNo-> 授权号 rrn-> 参考号 mcc->mcc码 respCode->返回码|

## 5.二维码交易
获取用户二维码/根据交易查询号查询结果
#### 5.1 二维码交易入参字段说明

| 字段名 | 含义     | 字段类型 | 是否必填 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
| qrCode   |获取用户二维码 |String   | 是| ip:port/qrCode/?amt=11 amt为交易金额 |
| queryNo  |  交易查询号 | String   | 是|ip:port/qrCode/1111  交易id获取交易详情  |
#### 5.2 二维码交易出参字段说明
|请求 | 出参类型     | 出参结果 |  出参结果含义 | 备注     |
| ------ | -------- | -------- | -------- | -------- |
| qrCode   |Map<String, String> | null| 无| ip:port/qrCode/?amt=11 amt为交易金额 |
| queryNo  |Map<String, String> | null| 无| ip:port/qrCode/2018031559018  queryNo->交易查询号|






